<!doctype html>
<html lang="en">
  <head>
    <title>Metronizer</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico" />

    <script src="section.js"></script>
    <script src="comment.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.1/p5.js"></script>
    <script src="canvas.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/addons/p5.sound.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ccapture.js@1.1.0/build/CCapture.all.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>

  <body id="body" class="dropZone">
    <main>
      <headerSection>HEADER</headerSection>
      <canvasSection>
        <div id="canvas-parent" class="canvas-parent"></div>
      </canvasSection>
      <controlSection>
        <div>
          <input
            type="range"
            title="Time"
            id="timeSlider"
            min="0"
            max="10000"
            value="0"
          />
        </div>
        <div id="control" class="control">
          <button id="btnPlayPause" type="button" aria-label="Play/Pause">
            <div id="iconPlayPause" class="no-background lottie-icon"></div>
          </button>
          <button id="btnParse" type="button" aria-label="Reset">
            <div id="iconReset" class="no-background lottie-icon"></div>
          </button>
        </div>
      </controlSection>
      <sectionSection>
        <h3>Sections</h3>
        <div class="header-row">
          <div>Bars</div>
          <div>BPM</div>
          <div>Measure</div>
        </div>
        <div id="sections" class="sections"></div>
        <button id="btnAddSection" class="centered-button">Add Section</button>
      </sectionSection>
      <commentSection>
        <h3>Comments</h3>
        <div class="header-row">
          <div>Bar</div>
          <div>Count</div>
          <div>Comment</div>
        </div>
        <div id="comments" class="comments"></div>
        <button id="btnAddComment" class="centered-button">Add Comment</button>
      </commentSection>
      <!-- SETTINGS -->
      <settingsArea>
        <h3 class="settingsHeader">Settings</h3>
        <settingsDiv>
          <!-- Title Input -->
          <div>
            <label for="titleInput" class="slider-label">Title</label>
            <input
              type="text"
              id="titleInput"
              placeholder="Enter title..."
              value="Metronizer Test Piece v2.1"
              title="Display title"
            />
          </div>
          <hr />
          <!-- Density Slider -->
          <div>
            <label for="sizeSlider" class="slider-label">Speed</label>
            <span id="sizeValue" class="slider-value">50</span>
            <input
              type="range"
              title="Density"
              id="sizeSlider"
              min="50"
              max="550"
              step="10"
              value="200"
              list="sizeTicks"
              oninput="sizeValue.textContent = this.value"
            />
            <datalist id="sizeTicks">
              <option value="50"></option>
              <option value="100"></option>
              <option value="150"></option>
              <option value="200"></option>
              <option value="250"></option>
              <option value="300"></option>
              <option value="350"></option>
              <option value="400"></option>
              <option value="450"></option>
              <option value="500"></option>
              <option value="550"></option>
            </datalist>
          </div>
          <!-- Bar Prononciation Slider -->
          <div>
            <label for="barSlider" class="slider-label">Beat Emphasis</label>
            <span class="slider-value"
              ><span id="barSliderValue">0</span>%</span
            >
            <input
              type="range"
              title="Bar Prononciation"
              id="barSlider"
              min="00"
              max="100"
              step="5"
              value="0"
              list="barTickList"
              oninput="barSliderValue.textContent = this.value"
            />
            <datalist id="barTickList">
              <option value="0"></option>
              <option value="10"></option>
              <option value="20"></option>
              <option value="30"></option>
              <option value="40"></option>
              <option value="50"></option>
              <option value="60"></option>
              <option value="70"></option>
              <option value="80"></option>
              <option value="90"></option>
              <option value="100"></option>
            </datalist>
          </div>
          <!-- Ball size Slider -->
          <div>
            <label for="ballSizeSlider" class="slider-label">Ball Size</label>
            <span id="ballSizeSliderValue" class="slider-value">0</span>
            <input
              type="range"
              title="Ball Size"
              id="ballSizeSlider"
              min="50"
              max="200"
              step="1"
              value="100"
              list="ballSizeTickList"
              oninput="ballSizeSliderValue.textContent = this.value"
            />
            <datalist id="ballSizeTickList">
              <option value="50"></option>
              <option value="65"></option>
              <option value="80"></option>
              <option value="95"></option>
              <option value="110"></option>
              <option value="125"></option>
              <option value="140"></option>
              <option value="155"></option>
              <option value="170"></option>
              <option value="185"></option>
              <option value="200"></option>
            </datalist>
          </div>
          <!-- Animation Type -->
          <div>
            <label for="animationType" class="slider-label"
              >Ball Animation</label
            >
            <select id="animationType" title="Ball Animation Type">
              <option value="none">None</option>
              <option value="bounce" selected>Bounce</option>
              <option value="triangle">Triangle</option>
              <option value="sawtooth">Sawtooth</option>
              <option value="sawtooth_inv">Inverted Sawtooth</option>
            </select>
          </div>
          <div class="toggle-row">
            <label for="toggleTimeRemaining" class="slider-label"
              >Show Time Remaining</label
            >
            <label class="switch">
              <input
                type="checkbox"
                id="toggleTimeRemaining"
                title="Show Time Remaining"
              />
              <span class="slider round"></span>
            </label>
          </div>
          <div class="toggle-row">
            <label for="toggleHeaderBoxes" class="slider-label"
              >Show Header Borders</label
            >
            <label class="switch">
              <input
                type="checkbox"
                id="toggleHeaderBoxes"
                title="Show Header Borders"
              />
              <span class="slider round"></span>
            </label>
          </div>
          <hr />
          <!-- Color Pickers -->
          <details class="color-section">
            <summary class="slider-label">Colors</summary>
            <div class="color-picker-group">
              <div class="color-picker-row">
                <label for="colorForeground" class="slider-label"
                  >Foreground</label
                >
                <input
                  type="color"
                  id="colorForeground"
                  value="#ffffff"
                  title="Foreground Color"
                />
              </div>
              <div class="color-picker-row">
                <label for="colorBackground" class="slider-label"
                  >Background</label
                >
                <input
                  type="color"
                  id="colorBackground"
                  value="#000000"
                  title="Background Color"
                />
              </div>
              <div class="color-picker-row">
                <label for="colorAccent" class="slider-label">Accent</label>
                <input
                  type="color"
                  id="colorAccent"
                  value="#ff0000"
                  title="Accent Color"
                />
              </div>
            </div>
          </details>
          <hr />
          <div class="toggle-row">
            <label for="toggleMetronome" class="slider-label">Play Sound</label>
            <label class="switch">
              <input
                type="checkbox"
                id="toggleMetronome"
                title="Play Sound"
              />
              <span class="slider round"></span>
            </label>
          </div>

          <hr />
          <div class="button-row">
            <span class="button-label">Load file</span>
            <button id="btnLoadFile">Load</button>
            <input
              type="file"
              id="fileInput"
              accept=".met,.txt"
              title="Load file"
            />
          </div>
          <div class="button-row">
            <span class="button-label">Save to file</span>
            <button id="btnSaveFile">Save</button>
          </div>
          <hr />
          <div class="button-row">
            <table class="export-info">
              <tr>
                <td>Resolution</td>
                <td>1920×1080</td>
              </tr>
              <tr>
                <td>FPS</td>
                <td>60</td>
              </tr>
              <tr>
                <td>Format</td>
                <td>.webm</td>
              </tr>
            </table>
            <button id="btnExport">Export</button>
          </div>
          <div id="activeRender">
            <h3 id="rendering" class="warning">Rendering, please wait</h3>
            <progress id="progressRender" value=".5">B</progress>
            <h3 id="renderFrame">xxx / XXX</h3>
          </div>
          <hr />
          <div class="keyboard-shortcuts">
            <strong>Keyboard Shortcuts</strong>
            <ul>
              <li>
                <span class="shortcut-keys"><kbd>␣</kbd></span> Play / Pause
              </li>
              <li>
                <span class="shortcut-keys"><kbd>←</kbd> / <kbd>→</kbd></span>
                Previous / Next section
              </li>
              <li>
                <span class="shortcut-keys"><kbd>↓</kbd> / <kbd>↑</kbd></span>
                Previous / Next bar
              </li>
              <li>
                <span class="shortcut-keys"><kbd>Ctrl</kbd>+ <kbd>S</kbd></span>
                Save file
              </li>
            </ul>
          </div>
        </settingsDiv>
      </settingsArea>
      <navSection></navSection>
      <!-- Footer -->
      <footer class="footer">
        <a class = "footer-left" href="https://lordicon.com/">Icons by Lordicon.com</a>
        <div class="footer-center">
          So far
          <div id="stats">###</div>
          people have visited this godforsaken website
        </div>
        <!-- <a href="./disclaimer.html" style="float: left">Disclaimer</a> -->
        <div>
          <a
            class = "footer-right"
            rel="noopener"
            href="https://github.com/AdminOfThis/Metronizer"
            target="_blank"
            >GitHub</a
          >
          |
          <a
            rel="noopener"
            href="https://github.com/AdminOfThis/metronizer/issues"
            target="_blank"
            >Issues</a
          >
        </div>
      </footer>
      <!-- Goat Counter Page counter -->
      <script
        data-goatcounter="https://metronizer.goatcounter.com/count"
        async
        src="//gc.zgo.at/count.js"
      ></script>
      <!-- Goat Counter Numbers -->
      <script>
        window.addEventListener("load", function () {
          if (!window.goatcounter || !window.goatcounter.get_data) {
            console.error("GoatCounter not loaded");
            return;
          }

          let path = window.goatcounter.get_data()["p"];

          fetch(
            "https://metronizer.goatcounter.com/counter/" +
              encodeURIComponent(path) +
              ".json",
          )
            .then((response) => {
              if (!response.ok) throw new Error("Counter not found");
              return response.json();
            })
            .then((data) => {
              document.getElementById("stats").innerText =
                data.count.toLocaleString();
            })
            .catch((err) => {
              console.error(err);
              document.getElementById("stats").innerText = "0";
            });
        });
      </script>
      <script src="animatedButton.js"></script>
      <script src="sketch.js"></script>
    </main>
  </body>
</html>
